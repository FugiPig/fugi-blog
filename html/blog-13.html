<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Zhang San's Blog Website</title>
        <link rel="stylesheet" href="mystyle.css">
    </head>
    <body>
        <big><h1 class="title-h">张三的博客</h1></big>
        <hr width="300">
        <h2 class="title-h">Zhang San's Blog</h4>
        <h2 class="title-h">当前/Curent: 分数规划简述.md</h3>
        %s
        <span class="blog-text"><h1>0003: 分数规划简述</h1>
<p>本篇博客为规划系列第 1 篇. 也以前置知识作为网络流系列的第 3 篇, 关于本系列详见<a href="https://www.luogu.com.cn/blog/fugi-tech/post-0000-bo-ke-mu-lu">0000: 博客目录</a>.</p>
<p>最近在研究最大权闭合图, 需要用到分数规划, 所以撰写此博客.</p>
<h2>1. 分数规划的基本形式</h2>
<p>我们给出<strong>分数规划(Fractional Programming)</strong> 的一般形式:</p>
<p>$$\begin{matrix}\min or\max{\lambda=\frac{a(x)}{b(x)}}&amp;(x\in S, b(x)&gt;0)\\end{matrix}$$</p>
<p>其中, 解向量$x$在解空间$S$内, $a(x)$和$b(x)$都是连续的实值函数. $a(x)$和$b(x)$之间有关联, 即在求解中会互相影响.</p>
<h3>1.1 对一般形式的应用举例</h3>
<p>为了使读者理解分数规划的形式, 我们引入一道例题<a href="https://www.luogu.com.cn/problem/P4322">P4322 [JSOI2016] 最佳团体</a>(练习题目 2).</p>
<h4>1.1.1 题意简述</h4>
<p>我们有一棵 $N+1$ 个节点的树, 编号分别为 $0,1,...,N$, 根节点编号为 0, 点 $i$ 的父亲是 $R_i$. 对于每个点 $i$ 有两个值 $S_i$ 和 $P_i$, 根节点的这两个值为 0. 我们要在树上找出 $K+1$ 个点, 如果要选点 $v$, 则必须选点 $v$ 的父亲 $R_v$, 根节点必须选. 设选的点集为 $X$($|X|=K+1$), 要求最大化 $\displaystyle ans=\max{\frac{\sum_{i\in X}P_i}{\sum_{i\in X}S_i}}$.</p>
<h4>1.1.2 对题意的简单变换</h4>
<p>对于某个 $X$, 我们设它所对应的解向量为 $x$, $|x|=N+1$, 对于 $0\le i\le N+1$, 有:</p>
<p>$$x_i=\begin{cases}1&amp;(i\in X)\0&amp;(i\notin X)\end{cases}$$</p>
<p>则 $X$ 对应的 $ans$ 可以变化为:</p>
<p>$$\displaystyle\frac{\sum_{i\in X}P_i}{\sum_{i\in X}S_i}=\frac{\sum_{i=0}^{N}P_i\cdot x_i}{\sum_{i=0}^{N}S_i\cdot x_i}$$</p>
<p>则一般形式中的实值函数 $a(x)=\sum_{i=0}^{N}P_i\cdot x_i$, $b(x)=\sum_{i=0}^{N}S_i\cdot x_i$.</p>
<p>接下来我们将讨论对于分数规划问题更一般性的解法, 对于本题的解法可以参见我发布的题解: <a href="https://www.luogu.com.cn/blog/fugi-tech/solution-p4322-post">题解: P4322</a>.</p>
<p>另外, 这个问题属于<strong>0-1分数规划(0-1 Fractional Programming)</strong>, 是分数规划的一个特例, 即解向量$x$的值均为$0$或$1$($\forall x_i\in {0,1}$). 这可以具象成一堆物体选或不选的问题.</p>
<h2>2. 求解前的准备工作</h2>
<p>我们设一个答案的猜测值为$\lambda$, 则$\lambda=\frac{a(x)}{b(x)}$, 移项得$a(x)-b(x)\cdot\lambda=0$. 由此我们发现, 若一个答案猜测值$\lambda'$与解向量$x'$匹配, 则$a(x')-b(x')\cdot\lambda'=0$定然成立. 因此我们可以构造一个函数$g(\lambda,x)=a(x)-b(x)\cdot\lambda$.</p>
<p>由于一个$\lambda$与$x$的匹配是合法的当且仅当$g(\lambda,x)=0$, 所以我们可以发现, 若$g(\lambda,x)&gt;0$, 则对于同一个$x$, $\lambda$可以也应当取得更大, 这样可以使$b(x)\cdot\lambda$更大. 同理, 若$g(\lambda,x)&lt;0$, 则$\lambda$可以也应当取得更小.</p>
<p>由此, 在最大化问题中, 我们构造$g_{max}(\lambda)=\max{a(x)-b(x)\cdot\lambda}$, 以使$\lambda$可以取得尽量大. 同理, 在最小化问题中, 我们构造$g_{min}(\lambda)=\min{a(x)-b(x)\cdot\lambda}$. 为了方便, 在下文中两函数性质相同的地方我们使用$g(\lambda)$表示.</p>
<h3>性质3.1 $g_{max}$和$g_{min}$均具有单调性</h3>
<p>$g(\lambda)$为严格递减函数, 即对于$\lambda_1&lt;\lambda_2$, 定然有$g(\lambda_1)&gt;g(\lambda_2)$.</p>
<blockquote>
<p><strong>证明</strong></p>
<p>先证$g_{min}$:</p>
<blockquote>
<p>我们记$g_{min}(\lambda_1)$的最小值对应的解向量为$x_1$: </p>
<p>$$\begin{aligned}g_{min}(\lambda_1)&amp;=\min{a(x)-b(x)\cdot\lambda_1}\&amp;=a(x_1)-b(x_1)\cdot\lambda_1\&amp;&gt;a(x_1)-b(x_1)\cdot\lambda_2&amp; (\lambda_1&lt;\lambda_2)\&amp;\ge\min{a(x)-b(x)}\cdot\lambda_2=g_{min}(\lambda_2)\\therefore g_{min}(\lambda_1)&gt;g_{min}(\lambda_2), \text{得证}\end{aligned}$$</p>
</blockquote>
<p>再证$g_{max}$:</p>
<blockquote>
<p>我们记$g_{max}(\lambda_2)$的最大值对应的解向量为$x_2$:</p>
<p>$$\begin{aligned}g_{max}(\lambda_2)&amp;=\max{a(x)-b(x)\cdot\lambda_2}\&amp;=a(x_2)-b(x_2)\cdot\lambda_2\&amp;<a(x_2)-b(x_2)\cdot\lambda_1&(\lambda_2>\lambda_1)\&amp;\le \max{a(x)-b(x)\cdot\lambda_1}=g_{max}(\lambda_1)\\therefore g_{max}(\lambda_2)&lt;g_{max}(\lambda_1), \text{得证}\end{aligned}$$</p>
</blockquote>
<p>综上, 我们分别证明了$g_{min}$和$g_{max}$均为严格递减函数.</p>
</blockquote>
<h3>定理3.2 Dinkelbach 定理</h3>
<p>设$\lambda^<em>$为原规划的最优解(这里以最小化为例), 则若$g_{min}(\lambda)=0$当且仅当$\lambda=\lambda^</em>$.</p>
<blockquote>
<p><strong>证明</strong></p>
<p>先证必要性: $\lambda=\lambda^*\Rightarrow g_{min}(\lambda)=0$, 即若$\lambda$为原规划最优解, 则$g_{min}(\lambda)=0$.</p>
<blockquote>
<p>对于所有的解向量$x\in S$, 我们设$\lambda^<em>$对应的是$x^</em>$, 则任意的$x$都不会比$x^*$优, 从而有:</p>
<p>$\lambda^<em>=\frac{a(x^</em>)}{b(x^<em>)}\le\frac{a(x)}{b(x)}\Rightarrow0\le a(x)-b(x)\cdot\lambda^</em>$</p>
<p>而$x^*$可以取到此下限(最大化则为上限):</p>
<p>$\lambda^<em>=\frac{a(x^</em>)}{b(x^<em>)}\Rightarrow0=a(x^</em>)-b(x^<em>)\cdot\lambda^</em>$</p>
<p>因此, $g_{min}(\lambda^*)=0$必然成立, 得证.</p>
</blockquote>
<p>再证充分性: $g_{min}(\lambda)=0\Rightarrow\lambda=\lambda^*$, 即若$g_{min}(\lambda)=0$, 则$\lambda$为该规划最优解.</p>
<blockquote>
<p>我们考虑反证, 设$\lambda'=\frac{a(x')}{b(x')}$是一个比$\lambda$更优的解, 从而有:</p>
<p>$\lambda'=\frac{a(x')}{b(x')}&lt;\lambda\Rightarrow a(x')-b(x')\cdot\lambda&lt;0$</p>
<p>如果该式成立, 则有$g_{min}(\lambda)&lt;0$, 导出矛盾, 从而得证.</p>
</blockquote>
<p>对于最大化的证明是一样的, 只需要将$\le$换成$\ge$, $&lt;$换成$&gt;$即可.</p>
</blockquote>
<h3>推论3.3 $g(\lambda)$的二分性质</h3>
<p>设$\lambda^*$为该规划的最优解, 则有:</p>
<p>$$\begin{cases}1. &amp;g(\lambda)&lt;0\Rightarrow\lambda&gt;\lambda^<em>\2.&amp;g(\lambda)=0\Rightarrow\lambda=\lambda^</em>\3.&amp;g(\lambda)&gt;0\Rightarrow\lambda&lt;\lambda^*\end{cases}$$</p>
<blockquote>
<p><strong>证明</strong></p>
<p>根据定理3.2, 2式显然.</p>
<p>而根据性质3.1, 我们要让$\lambda$逼近$\lambda^*$, 则1,3式显然.</p>
</blockquote>
<h2>3. 分数规划的求解</h2>
<h3>3.1 方法一: 二分</h3>
<h4>3.1.1 算法思路</h4>
<p>根据推论3.3, 我们可以对最优解$\lambda^*$进行二分答案.</p>
<h4>3.1.2 算法流程</h4>
<ol>
<li>每次猜测一个答案$\lambda$,.</li>
<li>求解$g_{min}(\lambda)$或$g_{max}(\lambda)$, 根据这个值和推论3.3缩小查找范围.</li>
</ol>
<h4>3.1.3 时间复杂度分析</h4>
<p>算法时间复杂度即为二分迭代次数与每次求解的复杂度的积.</p>
<h3>3.2 方法二: Dinkelbach 算法</h3>
<h4>3.2.1 算法思路</h4>
<p>我们发现, 在二分过程中, 当我们求解了 $g(\lambda)=\min or \max a(x)-b(x)\cdot\lambda$ 时, 有时可以求出对应的 $x$, 进而求出对应的 $\frac{a(x)}{b(x)}$.  我们可以将新的 $\lambda$ 设为这个 $\frac{a(x)}{b(x)}$, 重复此过程, 直到收敛成 $g(\lambda)=0$.</p>
<h4>3.2.2 时间复杂度分析</h4>
<p>根据数据的不同, 收敛的速度也有不同, 一般接近二分的速度, 但时间复杂度为$\varTheta(rand)$, 并且不会超过某个上限.</p>
<h2>4. 参考资料</h2>
<ul>
<li>《最小割模型在信息学竞赛中的应用》——胡伯涛</li>
<li>洛谷博客<a href="https://www.luogu.com.cn/blog/yestoday/post-01-fen-shuo-gui-hua-yang-xie">0/1 分数规划详解</a></li>
</ul>
<h2>5. 练习题目</h2>
<ol>
<li><a href="https://www.luogu.com.cn/problem/P6087">P6087 [JSOI2015] 送礼物</a></li>
<li><a href="https://www.luogu.com.cn/problem/P4322">P4322 [JSOI2016] 最佳团体</a></li>
<li><a href="https://www.luogu.com.cn/problem/P3705">P3705 [SDOI2017] 新生舞会</a></li>
<li><a href="https://www.luogu.com.cn/problem/P3199">P3199 [HNOI2009] 最小圈</a> (可使用 SPFA, 没有菊花网格图)</li>
<li><a href="https://www.luogu.com.cn/problem/P2494">P2494 [SDOI2011] 保密</a></li>
</ol></span>
    </body>
</html>